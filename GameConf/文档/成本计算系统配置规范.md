# **成本计算系统配置规范**

## **1. 概述**

本文档旨在为 `ActionCostConfig` 成本配置系统提供一套标准化的配置规范。所有需要动态计算成本的功能（如技能升级、装备强化、重生等）都应遵循此文档中定义的规则。

系统的核心是通过在 `条件` 与 `公式` 字段中，使用特定符号包裹的**变量**来实现动态计算。

## **2. 核心原则**

*   **符号决定类型**: 系统通过变量名两侧的符号（例如 `$...$` 或 `[...]`）来识别其数据来源。
*   **实时校验**: 编辑器会在您输入后进行实时校验。如果变量名不存在或语法错误，Unity 控制台会打印红色的错误信息，请务必保持控制台清洁无报错。
*   **顺序决定优先级**: 在“数量分段”列表中，规则的匹配是**从上到下**的。系统会使用它找到的**第一个**满足 `条件` 的规则。因此，请将最特殊、最优先的规则放在最上面，将通用的、默认的规则放在最下面。

## **3. 变量语法规则**

| 变量类型 | 语法格式 | 数据来源 (自动校验) | 说明 |
| :--- | :--- | :--- | :--- |
| **玩家变量** | `$变量名$` | `VariableNames.json` | 用于获取玩家的通用数据，例如重生次数、拥有的货币数量等。 |
| **玩家属性** | `{变量名}` | `VariableNames.json` | 用于获取玩家的核心战斗属性或统计数据，例如攻击力、历史最大战力等。 |
| **物品数量** | `[物品名]` | `ItemNames.json` | 用于获取玩家背包中某个物品的数量。 |

## **4. 特殊关键字**

| 关键字 | 语法格式 | 说明 |
| :--- | :--- | :--- |
| **关联等级** | `T_LVL` | 代表**当前成本配置所关联的对象自身的等级**。例如，如果是为“火球”技能配置成本，`T_LVL` 就代表火球技能的当前等级。 |

## **5. 支持的运算**

公式和条件字段支持所有标准的数学和逻辑运算。

*   **数学运算**: `+`, `-`, `*`, `/`, `%` (取余), `()` (括号改变优先级)。
*   **逻辑运算** (主要用于`条件`): `==`, `!=`, `>`, `<`, `>=`, `<=`。
*   **布尔运算** (主要用于`条件`): `&&` (与), `||` (或)。

## **6. 配置示例：装备强化**

以下示例演示了如何配置一个根据强化等级和特定物品（强化保护卷）变化的装备强化成本。

#### **Inspector 配置截图**

```
消耗列表:
  - 消耗类型: 玩家变量
    变量来源: 玩家变量
    消耗名称: 数据_固定值_金币
    数量分段:
      - 条件: T_LVL >= 10 && [强化保护卷] > 0
        公式: {数据_固定值_历史最大战力值} / 1000 + T_LVL * 500
      - 条件: 
        公式: {数据_固定值_历史最大战力值} / 2000 + T_LVL * 200
```

#### **示例解析**

1.  **消耗目标**: 本次强化消耗的是玩家变量 `数据_固定值_金币`。

2.  **规则匹配 (从上到下)**:
    *   **检查规则 1**: 系统首先检查第一个分段的 `条件`。如果装备的当前强化等级 (`T_LVL`) **大于等于10**，并且玩家背包中“强化保护卷”的数量 (`[强化保护卷]`) **大于0**，则此条规则匹配成功。金币的消耗数量将由第一个 `公式` 计算，计算过程结束。
    *   **检查规则 2**: 如果规则 1 的条件不满足，系统会继续检查下一个分段。由于第二个分段的 `条件` 字段为空，它将作为**默认规则**被匹配。金币的消耗数量将由第二个 `公式` 计算。

---